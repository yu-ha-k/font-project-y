	<!doctype html>
	<html lang="ko" class="demo_html">
		<head>
			<meta charset="UTF-8" />
			<meta name="viewport" content="width=device-width, initial-scale=1.0" />
			<title>i-ONE뱅크 기업 데모 페이지</title>
			<script type="text/javascript" src="../../../../js/com/comMobHeader.js"></script>
			<link rel="stylesheet" type="text/css" href="../../../../css/demo.css" />
			<script>
				$(function () {
					const $DOC = $(document);
					const $WIN = $(window);
		
					const dev_path  = '/html/';     //개발경로
					const pub_path  = '/pub/html/'; //퍼블경로
					
					const dp1_class_map = {
						"메인"		:"demo_lnb_ty1",
						"조회"		:"demo_lnb_ty2",
						"이체"		:"demo_lnb_ty3",
						"금융상품"		:"demo_lnb_ty4",
						"뱅킹업무"		:"demo_lnb_ty5",
						"B2B"		:"demo_lnb_ty6",
						"경영지원"		:"demo_lnb_ty7",
						"뱅킹관리"		:"demo_lnb_ty8",
						"결재함"		:"demo_lnb_ty9",
						"인증ㆍ보안"	:"demo_lnb_ty10",
						"IBK HELP"	:"demo_lnb_ty11"
					};
					
					const menu_list = webDevUtil.getMenuList("Y"); //메뉴정보 조회
						
					function buildTree(data) {
						// 최상위 ul 생성
						const rootUl = document.createElement('ul');
						rootUl.classList.add('demo_lnb_list', 'demo_lnb_depth_lv1');
						// 깊이별 트리를 생성하기 위한 트래커 오브젝트
						const depthTracker = { 1: rootUl };
						//현재 depth 제목을 추적
						let currentTitles = {1:"",2:"",3:"",4:""};
						
						data.forEach(item => {
							const depth = parseInt(item.depth);
							
							for (let d = 1; d <= depth; d++){
								const titleKey = `dp${d}_tit`;
								const title = item[titleKey];
								// 현재 depth 수준에서 제목이 비어 있지 않고, 아직 추가되지 않았다면 생성
								
								if (title && currentTitles[d] !== title){
									currentTitles[d] = title;
									
									const li = document.createElement('li');
									const button = document.createElement('button');
									const span = document.createElement('span');
									
									// 첫번째 depth 아이콘 설정
									button.classList.add('demo_lnb_btn');
									if(dp1_class_map[title]){
										button.classList.add(dp1_class_map[title]);
									}
									// 버튼 onclick
									button.id = item.menu_id;
									button.onclick = (event) => {
										const targetDiv = document.getElementById('demo_lnb');
										targetDiv.querySelectorAll('li').forEach(li => {
											li.classList.remove('active');
										})
										let currentLi = event.target.closest('li');

										while (currentLi) {
											currentLi.classList.add('active');
											currentLi = currentLi.parentElement.closest('li');
										}
										console.log(`Menu ID : ${item.menu_id}\nURL : ${item.menu_url}`);
										console.log(`admin : ${item.admin}\nic_type : ${item.ic_type}`);
										// 원하는 동작 수행
										if(item.admin != "") {
											document.getElementById('demo_admin').style.display = "";
										}
										else {
											document.getElementById('demo_admin').style.display = "none";
										}
										
										document.getElementById('viewer_cont_frame').classList.remove('default');
										document.getElementById('demo_admin').innerHTML 		= item.admin;
										document.getElementById('demo_indv_corp').innerHTML 	= item.ic_type;
										document.getElementById('demo_frame_title').innerHTML 	= title;
										document.getElementById('demo_frame').src 				= pub_path + item.menu_url;
										
										if(item.menu_id.indexOf('demo_login') > -1){
											document.getElementById('viewer_cont_frame').classList.add('login_case');
											const maxCnt = 20; // 10초
											let cnt = 0;
											let interval = setInterval(function(){
												cnt++;
												if(document.getElementById("demo_frame").contentWindow.$(".demo_visual_dom").length || cnt >= maxCnt){
													$("#"+$(".viewer_size_text").data("li-id")).click();
													stopInterval();
												}
											},500);
											function stopInterval(){
												clearInterval(interval);
											}
										}else{
											document.getElementById('viewer_cont_frame').classList.remove('login_case');
										}
									}
									span.textContent = title;
									span.classList.add('text');
									button.appendChild(span);
									
									li.appendChild(button);
	
									// 현재 depth의 ul에 li 추가
									depthTracker[d].appendChild(li);
									
									// 다음 depth를 위한 트래커 업데이트
									const parentUl = document.createElement('ul');
									parentUl.classList.add(`demo_lnb_depth_lv${d+1}`);
									depthTracker[d + 1] = li.appendChild(parentUl);
								}
							}
						});
						
						//불필요 ul 삭제
						const uls = rootUl.getElementsByTagName('ul');
						//역순으로 순회
						for(let i = uls.length -1; i >= 0; i--){
							const ul = uls[i];
							
							if(ul.children.length === 0){
								ul.remove();
							}
						}
						
						//toggle 클래스
						const buttons = rootUl.getElementsByTagName('button');
						for(let i = 0; i < buttons.length; i++){
							const button = buttons[i];
							const nextSibling = button.nextElementSibling;
							
							if(nextSibling && nextSibling.tagName === 'UL'){
								button.classList.add('toggle_able');
							}
						}
						
						return rootUl;
					};
					
					
					function drawTree(_data) {
						const demo_lnb = document.getElementById('demo_lnb');
						demo_lnb.innerHTML = '';
						demo_lnb.appendChild(buildTree(_data));
					}
					
					drawTree(menu_list);
					
					//--------------------------
// 					$DOC.on("click", ".toggle_able", function () {
// 						const $this = $(this);
// 						$this.closest("li").toggleClass("active");
// 					});
		
					$DOC.on("click", ".viewer_size_text", function () {
						const $this = $(this);
						$this.toggleClass("active");
					});
		
					$DOC.on("click", ".demo_size_guide_btn", function () {
						const $this = $(this);
						$this.toggleClass("active");
					});
		
					// 페이지 클릭시 툴팁 / 셀렉트 목록 숨기기
					$DOC.on("click", function (e) {
						const $tooltip = $(e.target).closest(".demo_content_head_util").length;
						if (!$tooltip) {
							$(".demo_size_guide_btn").removeClass("active");
						}
		
						const $sizePick = $(e.target).closest(".viewer_size_wrap").length;
						if (!$sizePick) {
							$(".viewer_size_text").removeClass("active");
						}
					});
		
					// 사이즈 값 받아오기
					$DOC.on("click", ".viewer_size_list > li", function (e) {
						const dataW = $(this).data("size-w");
						const dataH = $(this).data("size-h");
						const text = $(this).text();
						const id = e.currentTarget.id;
						
						$(".viewer_size_text").removeClass("active").find(".text").text(text);
						$(".viewer_size_text").data("li-id", id)
		
						$(".viewer_cont_frame").css("width", dataW);
						$(".viewer_cont_frame").css("height", dataH);
						
						if(document.getElementById("demo_frame").contentWindow.$){
							if (dataW > "799") {
								document.getElementById("demo_frame").contentWindow.$(".demo_visual_dom").addClass("v2");
							} else {
								document.getElementById("demo_frame").contentWindow.$(".demo_visual_dom").removeClass("v2");
							}
						}
					});
					
					// 검색 버튼
					$DOC.on("click", "#btn_demo_search", function () {
						const $this = $(this);
						const text = document.getElementById('search_text').value;
						
						drawTree(menu_list.filter( obj => obj.dp1_tit.includes(text) || obj.dp2_tit.includes(text) || obj.dp3_tit.includes(text) || obj.dp4_tit.includes(text)));
					});
					$DOC.on("keypress", "#search_text", function (e) {
						const $this = $(this);
						if(e.keyCode === 13){
							document.getElementById('btn_demo_search').click();
						}
					});
					
					// 초기화 버튼
					$DOC.on("click", ".btn_demo_reset", function () {
						const $this = $(this);
						const text = document.getElementById('search_text');
						text.value = '';
						
						drawTree(menu_list);
					});
					
					// iframe 내부 uf_back 호출
					$DOC.on("click", ".demo_history_back", function () {
						//document.getElementById('demo_frame').contentWindow.uf_back();
						document.getElementById('demo_frame').contentWindow.jex.plugin.get("JEX_MOBILE_STEP").showPrevCallStep();
					});
				});
			</script>
		</head>
		<body>
			<div class="demo_wrap">
				<aside class="demo_aside">
					<div class="demo_wrap_search_wrap">
						<h1 class="demo_logo">
							<img src="../../../../img/demo/img_demo_logo.png" alt="i-ONE뱅크 기업" />
						</h1>
						<div class="demo_wrap_search">
							<div class="input">
								<input type="text" name="" id="search_text" placeholder="메뉴검색" />
								<button class="btn_demo_search" id="btn_demo_search"><span class="text">검색</span></button>
							</div>
						</div>
						<div class="demo_wrap_search_btnarea">
							<button class="btn_demo_reset"><span class="text">검색 초기화</span></button>
						</div>
					</div>
	
					<!-- s: lnb -->
					<div class="demo_lnb" id="demo_lnb">
					</div>
					<!-- e: lnb -->
				</aside>
	
				<!-- s: demo_content -->
				<div class="demo_content">
					<div class="demo_content_head">
						<div class="demo_breadcrumbs">
							<span class="demo_breadcrumbs_tit">메뉴정보</span>
							<div class="demo_breadcrumbs_items">
								<span class="item" id="demo_indv_corp"></span>
								<span class="item" id="demo_admin"></span>
							</div>
						</div>
						<div class="demo_content_head_util">
							<div class="demo_size_guide">
								<button class="demo_size_guide_btn"><span class="text">사이즈 기준</span></button>
								<div class="demo_size_guide_list_wrap">
									<ul class="demo_size_guide_list">
										<li>
											<span class="l">갤럭시 S10</span>
											<span class="r">360X740</span>
										</li>
										<li>
											<span class="l">갤럭시 S20</span>
											<span class="r">360X800</span>
										</li>
										<li>
											<span class="l">갤럭시 S20 Ultra</span>
											<span class="r">412X914</span>
										</li>
										<li>
											<span class="l">갤럭시 S22</span>
											<span class="r">360X780</span>
										</li>
										<li>
											<span class="l">갤럭시폴드5 접힘</span>
											<span class="r">280X882</span>
										</li>
										<li>
											<span class="l">갤럭시폴드5 펼침</span>
											<span class="r">800X560</span>
										</li>
										<li>
											<span class="l">아이폰SE</span>
											<span class="r">375X667</span>
										</li>
										<li>
											<span class="l">아이폰12</span>
											<span class="r">390X844</span>
										</li>
										<li>
											<span class="l">아이폰15</span>
											<span class="r">393X852</span>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
	
					<div class="demo_content_viewer">
						<div class="viewer_size">
							<div class="viewer_size_wrap">
								<button class="viewer_size_text">
									<span class="text">360X740 (갤럭시 S10)</span>
								</button>
								<ul class="viewer_size_list">
									<li data-size-w="360" data-size-h="740" id="size_list_1">360*740 (갤럭시 S10)</li>
									<li data-size-w="360" data-size-h="800" id="size_list_2">360*800 (갤럭시 S20)</li>
									<li data-size-w="412" data-size-h="914" id="size_list_3">412*914 (갤럭시 S20 Ultra)</li>
									<li data-size-w="360" data-size-h="780" id="size_list_4">360*780 (갤럭시 S22)</li>
									<li data-size-w="280" data-size-h="882" id="size_list_5">280*882 (갤럭시폴드5 접힘)</li>
									<li data-size-w="800" data-size-h="560" id="size_list_6">800*560 (갤럭시폴드5 펼침)</li>
									<li data-size-w="375" data-size-h="667" id="size_list_7">375*667 (아이폰SE)</li>
									<li data-size-w="390" data-size-h="844" id="size_list_8">390*844 (아이폰12)</li>
									<li data-size-w="393" data-size-h="852" id="size_list_9">393*852 (아이폰15)</li>
								</ul>
							</div>
						</div>
	
						<div class="viewer_cont">
							<div id="viewer_cont_frame" class="viewer_cont_frame default" style="width: 360px;height: 740px">
								<div class="viewer_cont_frame_header">
									<a href="javascript:;" class="demo_history_back"><span class="text">이전</span></a>
									<h2 class="demo_frame_title" id="demo_frame_title"></h2>
									<button class="btn_demo_all_menu">전체메뉴</button>
								</div>
								<iframe src="" id="demo_frame" frameborder="0" class="inner"></iframe>
							</div>
						</div>
					</div>
				</div>
				<!-- e: demo_content -->
			</div>
		</body>
	</html>
